<%= turbo_frame_tag "template-selector" do %>
  <div id="template-selector-body" class="absolute top-11 right-0 w-4/5 border border-gray-200 bg-gray-50 rounded-lg shadow-sm animate-fade-in">
    <div class="p-3 border-b border-gray-200 flex gap-2 text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
      </svg>
      <p class="text-sm font-medium">Select template</p>
    </div>
    <div class="p-3 flex flex-col gap-3 overflow-y-auto max-h-[550px] relative"
         data-controller="template-selector-form">
      <%= form_with url: "tmp",
        id: :multi_template_form,
        data: {
          action: "turbo:submit-end->template-selector-dropdown#toggle
                   turbo:submit-start->template-selector-dropdown#showLoadingOverlay"
        },
        class: "hidden" do |form| %>
      <% end %>
      <% @templates.each do |template| %>
        <div data-template-selector-form-target="templateRow"
             data-selected="<%= template.id == @topic.template_id %>"
             data-is-checked="false"
             class="text-sm text-left rounded-lg w-full flex items-center border-gray-200 border text-gray-600
                    data-[selected=true]:[&:not([data-is-checked=true])]:bg-gray-100
                    data-[is-checked=true]:bg-blue-50
                    data-[is-checked=true]:text-blue-600
                    data-[is-checked=true]:border-blue-200">
          <div class="group grid size-4 grid-cols-1 mx-4 flex-none">
            <%= check_box_tag "checkbox_#{template.id}",
                              "checkbox_#{template.id}",
                              false,
                              data: {
                                template_selector_form_target: "templateCheckbox",
                                action: "template-selector-form#toggleCheck"
                              },
                              form: :multi_template_form,
                              class: "col-start-1 row-start-1 appearance-none rounded border border-gray-300 bg-white checked:border-blue-600 checked:bg-blue-600" %>
            <svg class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white group-has-[:disabled]:stroke-gray-950/25" viewBox="0 0 14 14" fill="none">
              <path class="opacity-0 group-has-[:checked]:opacity-100" d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path class="opacity-0 group-has-[:indeterminate]:opacity-100" d="M3 7H11" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
          <%= form_with url: change_template_topic_path(@topic),
                        method: :post,
                        class: "flex-1",
                        data: {
                          action: "turbo:submit-end->template-selector-dropdown#toggle
                                   turbo:submit-start->template-selector-dropdown#showLoadingOverlay"
                        } do |f| %>
            <%= f.hidden_field :template_id, value: template.id %>
            <%= f.submit template.output,
              class: "text-left py-3 pr-3 w-full whitespace-normal hover:cursor-pointer" %>
          <% end %>
        </div>
      <% end %>
      <div data-template-selector-form-target="multiselect"
                         data-total-checked="0"
                         class="data-[total-checked=0]:hidden flex justify-center sticky bottom-0 right-0 left-0">
        <%= button_to "#", class: "text-white bg-blue-500 hover:bg-blue-600 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center inline-flex items-center gap-2" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          <span data-template-selector-form-target="buttonText"></span>
        <% end %>
      </div>
    </div>
    <div class="p-3 border-t border-gray-200 flex gap-2 text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      <p class="text-sm font-medium">Create a new template</p>
    </div>
    <div class="hidden data-[loading]:flex absolute top-0 bottom-0 left-0 right-0 bg-white bg-opacity-75 rounded-lg items-center justify-center" data-template-selector-dropdown-target="loadingOverlay">
      <svg class="animate-spin h-8 w-8 text-blue-600 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
  </div>
<% end %>

<%= render 'shared/navbar' %>
<div class="bg-gray-100 border-b border-gray-200 min-h-[41px]">
  <div class="container mx-auto px-3 flex align-center text-slate-500 divide-x divide-gray-300 pb-2">
    <%= link_to root_path, class: "flex items-center bg-gray-50 border border-gray-200 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 rounded-lg px-2 py-0.5 me-3" do %>
      <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
      <p class="pl-2 font-medium">Inbox</p>
    <% end %>
    <div>
      <p class="text-lg text-slate-600 font-semibold ms-3"><%= @topic.subject %></p>
    </div>
  </div>
</div>
<div class="container mx-auto px-3">
  <%= form_with model: [@template], id: "referenced_template_form", data: { controller: "regenerate", action: "regenerate#copyQueryToUpdateForm"} do |form| %>
    <div class="mt-2 flex flex-wrap gap-8">
      <div class="w-full mt-4 md:w-[calc(50%-1rem)]">
        <h1 class="text-2xl font-semibold text-slate-800">
          Referenced template
        </h1>
        <p class="text-slate-700 mb-5">
          The generated response used this template to provided guidance and structure.
        </p>
        <%= form.label :input, "Example recieved email", class: "block text-sm font-medium text-gray-900 mb-2" %>
        <%= form.text_area :input, rows: 6, placeholder: "Write a template recieved email here", class: "block p-4 w-full text-sm text-gray-900 bg-gray-100 rounded-lg border border-gray-200 focus:ring-blue-500 focus:border-blue-500 resize-none" %>
      </div>
      <div class="w-full md:w-[calc(50%-1rem)]" data-controller="iframe-resize">
        <ul class="divide-y divide-y-gray-300">
          <% @messages.each do |message| %>
            <li class="pt-4 pb-5">
              <div class="flex justify-between">
                <p class="text-slate-700 font-semibold truncate"><%= message.from %></p>
                <p class="text-slate-500 whitespace-nowrap ms-2">
                  <% if message.date.to_date == Date.today %>
                    <%= message.date.strftime("%l:%M %p") %>
                  <% else %>
                    <%= message.date.strftime("%b %d") %>
                  <% end %>
                </p>
              </div>
              <p class="text-slate-500 truncate"> to <%= message.to %></p>
              <div class="mt-2">
                <div class="text-center" data-iframe-resize-target="loader">
                  <div role="status">
                    <svg class="animate-spin h-8 w-8 text-gray-400 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
                <iframe
                srcdoc="<%= message.replace_cids_with_urls request.base_url %>"
                sandbox="allow-same-origin"
                class="w-full hidden  rounded bg-white"
                data-iframe-resize-target="iframe">
                </iframe>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="flex flex-wrap gap-8">
      <div class="w-full mt-6 md:w-[calc(50%-1rem)]">
        <%= form.label :output, "Example response email", class: "block text-sm font-medium text-gray-900 mb-2" %>
        <%= form.text_area :output, rows: 6, placeholder: "Write a template response email here", class: "block p-4 w-full text-sm text-gray-900 bg-gray-100 rounded-lg border border-gray-200 focus:ring-blue-500 focus:border-blue-500 resize-none" %>
        <%= form.hidden_field :save_and_regenerate, value: true %>
        <%= form.hidden_field :query, data: { regenerate_target: "updateQueryField" } %>
        <div class="flex justify-start mt-4">
          <button type="submit" class="text-white bg-slate-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
            </svg>
            Save changes and regenerate
          </button>
        </div>
      </div>
      <div class="w-full mt-6 md:w-[calc(50%-1rem)]">
        <%= form_with model: [@template], class: "mt-5" do |form| %>
          <%= form.label :input, "Generated reply", class: "block text-sm font-medium text-gray-900 mb-2" %>
          <%= form.text_area :input, rows: 6, value: @generated_reply, placeholder: "Write a template recieved email here", class: "block p-4 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-200 focus:ring-blue-500 focus:border-blue-500 resize-none" %>
          <div class="flex justify-start">
            <button type="submit" class="text-white mt-4 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
              </svg>
              Send reply
            </button>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

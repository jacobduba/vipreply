<%= turbo_frame_tag "template-selector" do %>
  <div id="template-selector-body" class="absolute top-11 right-0 w-full max-w-[36rem] border border-stone-200 bg-stone-50 rounded-lg shadow-sm animate-fade-in">
    <div class="px-3 border-b border-stone-200 flex justify-between items-center">
      <ul class="flex flex-wrap gap-3 pt-3 text-sm font-medium text-center text-stone-500">
        <li class="me-2">
          <%= link_to template_selector_dropdown_topic_path, class: "inline-flex items-center gap-2 pb-3 border-b-2 border-transparent text-stone-600 hover:text-stone-900 hover:border-stone-500" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
            </svg>
            Choose smart cards
          <% end %>
        </li>
        <li class="me-2">
          <div class="inline-flex items-center gap-2 pb-3 border-b-2 text-stone-800 border-stone-800 hover:cursor-default">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Create smart card
          </div>
        </li>
      </ul>
      <button type="button"
        data-action="click->template-selector-dropdown#toggle"
        class="hover:cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-stone-400 hover:text-stone-600">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="p-3 flex flex-col gap-3 overflow-y-auto max-h-[550px] relative">
      <%= form_with url: create_template_dropdown_topic_path,
                    scope: :template,
                    data: {
                      action: "turbo:submit-end->template-selector-dropdown#toggle
                              turbo:submit-start->template-selector-dropdown#showLoadingOverlay",
                    } do |form| %>
        <div class="grid gap-4 mb-4 grid-cols-2">
          <div class="col-span-2">
            <%= form.label :output, "Smart template", class: ["block text-sm font-medium text-stone-900", (@output_errors.empty? ? "mb-2" : "text-red-800")] %>
            <ul class="list-disc list-inside text-red-800 text-sm mb-2">
              <% @output_errors.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
            <%= form.text_area :output,
                rows: 3,
                placeholder: "Write a smart template you can reuse for similar emails...",
                data: { controller: "textbox-autoresize" },
                autocomplete: "off",
                class: "block border border-stone-200 px-4 py-3 w-full text-sm text-stone-900 bg-stone-100 rounded-lg focus:outline-none focus:border-blue-500/90 resize-none" %>
          </div>
        </div>
        <div class="flex gap-2">
          <button type="submit" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center gap-2 hover:cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Create and generate reply
          </button>
        </div>
      <% end %>
    </div>
    <!-- Loading Overlay -->
    <div class="hidden data-[loading]:flex absolute top-0 bottom-0 left-0 right-0 bg-white opacity-75 rounded-lg items-center justify-center" data-template-selector-dropdown-target="loadingOverlay">
      <svg class="animate-spin h-8 w-8 text-blue-600 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
  </div>
<% end %>

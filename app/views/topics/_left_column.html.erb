<div data-controller="template-selector-dropdown" data-action="click@window->template-selector-dropdown#closeIfOutsideSelector" class="relative">
  <div class="flex justify-between lg:mt-3 mb-4">
    <%= render 'change_status_button' %>
    <%= link_to template_selector_dropdown_topic_path(animate: true),
                    data: {
                        turbo_frame: "template-selector",
                        template_selector_dropdown_target: "button",
                        action: "click->template-selector-dropdown#toggle",
                        active: false
                    },
                    class: "text-stone-600 bg-white border border-stone-200 focus:outline-none hover:bg-stone-100 font-medium rounded-lg text-sm px-4 py-2 inline-flex items-center gap-2 data-[active=true]:bg-stone-100 #{'opacity-50 cursor-not-allowed pointer-events-none' unless @topic.requires_action_human_needed?}" do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 0 0 2.25-2.25V6a2.25 2.25 0 0 0-2.25-2.25H6A2.25 2.25 0 0 0 3.75 6v2.25A2.25 2.25 0 0 0 6 10.5Zm0 9.75h2.25A2.25 2.25 0 0 0 10.5 18v-2.25a2.25 2.25 0 0 0-2.25-2.25H6a2.25 2.25 0 0 0-2.25 2.25V18A2.25 2.25 0 0 0 6 20.25Zm9.75-9.75H18a2.25 2.25 0 0 0 2.25-2.25V6A2.25 2.25 0 0 0 18 3.75h-2.25A2.25 2.25 0 0 0 13.5 6v2.25a2.25 2.25 0 0 0 2.25 2.25Z" />
      </svg>
      Attach Smart Cards
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
        <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
      </svg>
    <% end %>
  </div>
  <% if @topic.no_action_required_marked_by_user? %>
    <div class=" border-2 border-dashed border-stone-300 rounded-lg px-3 py-4 flex flex-col items-center">
      <div class="text-stone-600 flex gap-2 items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
        <p>You moved this topic to No Action Required.</p>
      </div>
      <p class="text-center mt-4 text-sm text-stone-500">Replies are disabled for topics in No Action Required. </p>
      <p class="text-center text-sm text-stone-500">To reply to this topic, move the topic back to Requires Action.</p>
    </div>
  <% elsif @topic.no_action_required_marked_by_ai? %>
    <div class=" border-2 border-dashed border-stone-300 rounded-lg px-3 py-4 flex flex-col items-center">
      <div class="text-stone-600 flex gap-2 items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002" />
        </svg>
        <p>VIPReply auto-moved this topic to No Action Required.</p>
      </div>
      <p class="text-center mt-4 text-sm text-stone-500">VIPReply determined this topic wasn't a customer support request.</p>
      <p class="text-center text-sm text-stone-500">To reply to this topic, move the topic back to Requires Action.</p>
    </div>
  <% elsif @topic.no_action_required_awaiting_customer? %>
    <div class=" border-2 border-dashed border-stone-300 rounded-lg px-3 py-4 flex flex-col items-center">
      <div class="text-stone-600 flex gap-2 items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
        </svg>
        <p>Waiting for customer reply.</p>
      </div>
      <p class="text-center mt-4 text-sm text-stone-500">VIPReply moves topics to No Action Required when awaiting a customer reply.</p>
      <p class="text-center text-sm text-stone-500">To reply to this topic again, move the topic back to Requires Action.</p>
    </div>
  <% elsif @topic.no_action_required_is_old_email? %>
    <div class=" border-2 border-dashed border-stone-300 rounded-lg px-3 py-4 flex flex-col items-center">
      <div class="text-stone-600 flex gap-2 items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
        <p>Imported topics older than <%= Topic::OLD_EMAIL_DAYS_THRESHOLD %> days auto-moved to No Action Required.</p>
      </div>
      <p class="text-center mt-4 text-sm text-stone-500">Replies are disabled for topics in No Action Required. </p>
      <p class="text-center text-sm text-stone-500">To reply to this topic, move the topic back to Requires Action.</p>
    </div>
  <% elsif @topic.requires_action_ai_auto_replied? %>
    <div class=" border-2 border-dashed border-stone-300 rounded-lg px-3 py-4 flex flex-col items-center">
      <div class="text-stone-600 flex gap-2 items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
        </svg>
        <p>Review auto-reply sent by VIPReply.</p>
      </div>
      <p class="text-center mt-2 text-sm text-stone-500">Move topic to No Action Required if no further action is needed.</p>
      <div class="flex gap-3 mt-4">
        <%= button_to move_to_no_action_required_topic_path(@topic),
              method: :post,
              class: "text-white bg-blue-600 hover:bg-blue-700 focus:outline-none font-medium rounded-lg text-sm px-4 py-2 inline-flex items-center gap-2 cursor-pointer" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          Move to No Action Required
        <% end %>
        <%= button_to move_to_requires_action_topic_path(@topic),
             method: :post,
             class: "text-stone-600 bg-white border border-stone-200 focus:outline-none hover:bg-stone-100 font-medium rounded-lg text-sm px-4 py-2 inline-flex items-center gap-2 cursor-pointer" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
          </svg>
          Draft follow up reply
        <% end %>
      </div>
    </div>
  <% elsif @topic.requires_action? %>
    <%= turbo_frame_tag "template-selector", data: { template_selector_dropdown_target: "selector"} %>
    <%= render "topics/template_form", input_errors: [], output_errors: [], topic: @topic %>
    <%= render "topics/generated_reply_form", generated_reply: @topic.generated_reply, topic: @topic %>
  <% end %>
</div>
